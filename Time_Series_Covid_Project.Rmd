---
title: "Time_Series_Covid_Project"
author: "Reagan Meagher and Megan Riley"

output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Global Options
remove(list = ls())

#Load Packages
library(tidyverse)
library(dplyr)
library(tseries)
library(ggplot2)
library(forecast)
library(tswge)
library(tseries)
library(orcutt)
library(mice)
```

```{r}
initial_data_fl <- read.csv(file="https://raw.githubusercontent.com/megnn/TimeSeries_Covid/master/covidtracking_FL_data.csv", header=TRUE)
initial_data_us <- read.csv(file="https://raw.githubusercontent.com/megnn/TimeSeries_Covid/master/covidtracking_US_data.csv", header=TRUE)

initial_data_fl = initial_data_fl[order(nrow(initial_data_fl):1),]
initial_data_us = initial_data_us[order(nrow(initial_data_us):1),]
```

```{r}
for (i in 1:nrow(initial_data_fl)) {
  n <- round((initial_data_fl$positiveIncrease / initial_data_fl$totalTestResultsIncrease) * 100, digits = 4)
  initial_data_fl$positive_percentage <- n
}

for (i in 1:nrow(initial_data_us)) {
  n <- round((initial_data_us$positiveIncrease / initial_data_us$totalTestResultsIncrease) * 100, digits = 4)
  initial_data_us$positive_percentage <- n
}

len_fl = dim(initial_data_fl)[1]
len_us = dim(initial_data_us)[1]
```

Another way to add the columns

```{r}

initial_data_fl = initial_data_fl %>% mutate(positive_percentage = round((initial_data_fl$positiveIncrease / initial_data_fl$totalTestResultsIncrease) * 100, digits = 4))

initial_data_us = initial_data_us %>% mutate(positive_percentage = round((initial_data_us$positiveIncrease / initial_data_us$totalTestResultsIncrease) * 100, digits = 4))

len_fl = dim(initial_data_fl)[1]
len_us = dim(initial_data_us)[1]

```

Looking at percent positives.

Also segmenting the percent positive trends after initial high positive rates. This allows us to model positive percentage if we make the assumption the pattern of positive percentages has changed after a first period of high percent positives.  

```{r}

plot(x = seq(1:len_fl), y = initial_data_fl$positive_percentage, type = "l")

plot(x = seq(21:135), y = initial_data_fl[21:135,42], type = "l")


plot(x = seq(1:len_us), y = initial_data_us$positive_percentage, type = "l")

plot(x = seq(45:177), y = initial_data_us[45:177,26], type = "l")


```


Setting up data frames for predicting cases. 

```{r}
newcases_fl <- dplyr::select(initial_data_fl, c("date", "positiveIncrease"))
newcases_us <- dplyr::select(initial_data_us, c("date", "positiveIncrease"))
```

Plotting the daily positive cases in Florida and US. 

```{r}
plot(x = seq(1,len_fl), y = newcases_fl$positiveIncrease, type = "l")
plot(x = seq(1,len_us), y = newcases_us$positiveIncrease, type = "l")
```

Checking for NAs

```{r NA eval}
#Checking for NAs
md.pattern(newcases_fl)
# No NAs present

#Drop NAs that are present
newcases_fl <- na.omit(newcases_fl)

#Checking for NAs
md.pattern(newcases_us)
#No NAs present

#Drop NAs that are present
newcases_us <- na.omit(newcases_us)
```

```{r}
plotts.sample.wge(newcases_fl$positiveIncrease)
```



Building an ARIMA model on Florida Cases

```{r}
aic5.wge(newcases_fl$positiveIncrease)
aic5.wge(newcases_fl$positiveIncrease, type = 'bic')

positiveIncrease_diff = artrans.wge(newcases_fl$positiveIncrease, 1)
newcases_fl_diff = data.frame( date = seq(1,length(positiveIncrease_diff)), positiveIncrease_diff = positiveIncrease_diff)

aic5.wge(newcases_fl_diff$positiveIncrease_diff)


fl_arima_est = est.arma.wge(newcases_fl_diff$positiveIncrease_diff, p = 2, q = 2)


```

Building an ARIMA model on US Cases
```{r}
plotts.sample.wge(newcases_us$positiveIncrease)

positiveIncrease_diff = artrans.wge(newcases_us$positiveIncrease, 1)
newcases_us_diff = data.frame( date = seq(1,length(positiveIncrease_diff)), positiveIncrease_diff = positiveIncrease_diff)

#Maxing out at 5,2 lets check the BIC and expand ps
aic5.wge(newcases_us_diff$positiveIncrease_diff, p = 0:10, type = "bic")

us_arima_est = est.arma.wge(newcases_us_diff$positiveIncrease_diff, p = 6, q = 2)

```




